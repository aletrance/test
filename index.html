<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>NYC Travel Planner - 3 días en Nueva York + 3 de Julio en Washington DC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f4f7fa;
      margin: 0;
      padding: 0;
      color: #222;
    }
    header {
      background: #222b45;
      color: #fff;
      padding: 2rem 1rem 1rem 1rem;
      text-align: center;
      box-shadow: 0 2px 8px #ddd;
    }
    h1 {
      margin: 0 0 0.5rem 0;
      font-size: 2.2rem;
    }
    .tabs {
      display: flex;
      justify-content: center;
      background: #fff;
      box-shadow: 0 2px 8px #e0e0e0;
      margin-top: -1rem;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .tab {
      padding: 1rem 2rem;
      cursor: pointer;
      font-weight: 500;
      color: #222b45;
      border: none;
      background: none;
      border-bottom: 3px solid transparent;
      transition: border .2s;
      outline: none;
      font-size: 1.1rem;
    }
    .tab.active {
      border-bottom: 3px solid #0099cc;
      color: #0099cc;
      background: #f7fafc;
    }
    .tabcontent {
      display: none;
      padding: 2rem;
      max-width: 900px;
      margin: 0 auto;
      background: #fff;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 4px 20px #e0e6ed;
      margin-bottom: 2rem;
    }
    .tabcontent.active {
      display: block;
    }
    .map-container {
      width: 100%;
      height: 380px;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 1.2rem;
      border: 1px solid #dde4eb;
      box-shadow: 0 2px 8px #f7faff;
    }
    .itinerary {
      background: #f7fafc;
      border-radius: 8px;
      padding: 1.2rem 1.5rem;
      margin-bottom: 1rem;
      border-left: 4px solid #0099cc;
      box-shadow: 0 2px 8px #e0e6ed;
    }
    .eat, .tips {
      background: #effaff;
      border-radius: 8px;
      padding: 1rem 1.5rem;
      margin-bottom: 1rem;
      border-left: 4px solid #27ae60;
      box-shadow: 0 2px 8px #e0e6ed;
    }
    .eat h3, .tips h3 {
      margin-top: 0;
      color: #27ae60;
    }
    .tips {
      border-left: 4px dashed #e67e22;
      background: #fff9ee;
    }
    .tips h3 {
      color: #e67e22;
    }
    .itinerary strong {
      color: #0099cc;
    }
    @media (max-width: 700px) {
      .tabcontent { padding: 1rem; }
      .tabs { flex-direction: column; }
      .tab { width: 100%; }
      .map-container { height: 250px; }
    }
    .horario {
      color: #0099cc;
      font-weight: bold;
      margin-right: 0.5em;
    }
  </style>
</head>
<body>
  <header>
    <h1>NYC Travel Planner</h1>
    <p>Itinerario optimizado de 3 días en Nueva York + 3 de Julio en Washington DC &mdash; Mapa, recomendaciones, comida barata y tips</p>
  </header>

  <div class="tabs">
    <button class="tab active" data-tab="dia1">Día 1</button>
    <button class="tab" data-tab="dia2">Día 2</button>
    <button class="tab" data-tab="dia3">Día 3</button>
    <button class="tab" data-tab="washington">3 de Julio: Washington DC</button>
  </div>

  <div id="dia1" class="tabcontent active">
    <div class="map-container" id="map-dia1"></div>
    <!-- resto igual ... -->
  </div>
  <div id="dia2" class="tabcontent">
    <div class="map-container" id="map-dia2"></div>
    <!-- resto igual ... -->
  </div>
  <div id="dia3" class="tabcontent">
    <div class="map-container" id="map-dia3"></div>
    <!-- resto igual ... -->
  </div>
  <div id="washington" class="tabcontent">
    <div class="map-container" id="map-washington"></div>
    <!-- resto igual ... -->
  </div>

  <script>
    // Simple tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', function() {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tabcontent').forEach(tc => tc.classList.remove('active'));
        this.classList.add('active');
        document.getElementById(this.dataset.tab).classList.add('active');
        renderMap(this.dataset.tab); // Render the map for the tab shown!
      });
    });

    // Helper to clear previous maps before rendering a new one (avoid overlays, memory leaks)
    function clearMap(id) {
      let container = document.getElementById(id);
      if (container) {
        container.innerHTML = ""; // Remove any previous map instance
      }
    }

    // Render the map for the visible tab
    function renderMap(tab) {
      if (tab === "dia1") {
        clearMap('map-dia1');
        let map = new google.maps.Map(document.getElementById('map-dia1'), {center: {lat: 40.7648, lng: -73.9787}, zoom: 13});
        let points = [
          {lat: 40.7829, lng: -73.9654, label: "1. Central Park"},
          {lat: 40.758465, lng: -73.976865, label: "2. Catedral de San Patricio"},
          {lat: 40.747993, lng: -74.004765, label: "3. High Line"},
          {lat: 40.7420, lng: -74.0060, label: "4. Chelsea Market"},
          {lat: 40.7527, lng: -73.9772, label: "5. Grand Central Terminal"},
          {lat: 40.7587, lng: -73.9787, label: "6. Top of the Rock"}
        ];
        addMarkersAndRoute(map, points, "#0099cc");
      }
      if (tab === "dia2") {
        clearMap('map-dia2');
        let map = new google.maps.Map(document.getElementById('map-dia2'), {center: {lat: 40.7127, lng: -74.0060}, zoom: 13});
        let points = [
          {lat: 40.7033, lng: -74.0170, label: "1. Battery Park"},
          {lat: 40.7061, lng: -74.0087, label: "2. Wall Street & Charging Bull"},
          {lat: 40.7126, lng: -74.0099, label: "3. Oculus & World Trade Center"},
          {lat: 40.7158, lng: -73.9970, label: "4. Chinatown"},
          {lat: 40.7061, lng: -73.9969, label: "5. Brooklyn Bridge (Manhattan)"}
        ];
        addMarkersAndRoute(map, points, "#e67e22");
      }
      if (tab === "dia3") {
        clearMap('map-dia3');
        let map = new google.maps.Map(document.getElementById('map-dia3'), {center: {lat: 40.7549, lng: -73.9840}, zoom: 13});
        let points = [
          {lat: 40.748817, lng: -73.985428, label: "1. Empire State Building"},
          {lat: 40.7536, lng: -73.9832, label: "2. Bryant Park"},
          {lat: 40.7532, lng: -73.9822, label: "3. Biblioteca Pública de Nueva York"},
          {lat: 40.7580, lng: -73.9855, label: "4. Times Square"}
        ];
        addMarkersAndRoute(map, points, "#27ae60");
      }
      if (tab === "washington") {
        clearMap('map-washington');
        let map = new google.maps.Map(document.getElementById('map-washington'), {center: {lat: 38.8977, lng: -77.0365}, zoom: 12});
        let points = [
          {lat: 38.9306, lng: -77.0706, label: "1. Catedral Nacional de Washington"},
          {lat: 38.9076, lng: -77.0723, label: "2. Universidad de Georgetown"},
          {lat: 38.9040, lng: -77.0624, label: "3. Old Stone House"},
          {lat: 38.8882, lng: -77.0199, label: "4. Museo Nacional del Aire y el Espacio"},
          {lat: 38.8899, lng: -77.0091, label: "5. Capitolio"}
        ];
        addMarkersAndRoute(map, points, "#ff5252", "DRIVING");
      }
    }

    function addMarkersAndRoute(map, points, color, travelMode) {
      for (let i = 0; i < points.length; i++) {
        new google.maps.Marker({
          position: {lat: points[i].lat, lng: points[i].lng},
          map: map,
          label: {
            text: (i+1).toString(),
            color: "#fff",
            fontWeight: "bold",
            fontSize: "14px"
          },
          title: points[i].label
        });
      }
      let directionsService = new google.maps.DirectionsService();
      let directionsRenderer = new google.maps.DirectionsRenderer({
        suppressMarkers: true,
        polylineOptions: { strokeColor: color, strokeWeight: 4 }
      });
      directionsRenderer.setMap(map);
      let waypoints = [];
      for (let i = 1; i < points.length - 1; i++) {
        waypoints.push({ location: {lat: points[i].lat, lng: points[i].lng}, stopover: true });
      }
      directionsService.route({
        origin: {lat: points[0].lat, lng: points[0].lng},
        destination: {lat: points[points.length-1].lat, lng: points[points.length-1].lng},
        waypoints: waypoints,
        travelMode: travelMode || "WALKING"
      }, function(response, status) {
        if (status === "OK") {
          directionsRenderer.setDirections(response);
        }
      });
    }

    // Google Maps async loader
    let gmapsLoaded = false;
    function loadGoogleMapsScript() {
      if (gmapsLoaded) return;
      gmapsLoaded = true;
      let script = document.createElement('script');
      script.src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyBZKxlKu8Vxe3xrtdH8AhcBvkfnwG3TxAQ&callback=onGMapsLoaded";
      script.async = true;
      document.body.appendChild(script);
    }
    window.onGMapsLoaded = function() { renderMap('dia1'); }
    window.addEventListener('DOMContentLoaded', loadGoogleMapsScript);
  </script>
</body>
</html>